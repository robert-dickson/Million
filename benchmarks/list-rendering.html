<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <script src="https://cdn.jsdelivr.net/combine/npm/lodash@4.17.21,npm/platform@1.3.6,npm/benchmark@2.1.4"></script>
    <script src="https://unpkg.com/million"></script>
  </head>
  <body>
    <div id="app"></div>

    <script>
      const { m, _, patch } = Million;

      const suite = new Benchmark.Suite();

      let i = 0;
      suite
        .add('Million', {
          setup() {
            document.querySelector('#app').outerHTML = '<div id="app"></div>';
            i = 0;
          },
          fn() {
            const children = [];

            for (let j = 0; j < i; j++) {
              children.push(m('div', _, [String(Date.now())]));
            }

            patch(m('div', { id: 'app' }, children), document.querySelector('#app'));
            ++i;
          },
        })
        .add('JavaScript Optimal', {
          setup() {
            document.querySelector('#app').outerHTML = '<div id="app"></div>';
            i = 0;
          },
          fn() {
            const wrapper = document.createElement('div');

            for (let j = 0; j < i; j++) {
              const div = document.createElement('div');
              const text = document.createTextNode(Date.now());
              div.appendChild(text);
              wrapper.appendChild(div);
            }

            if (document.querySelector('#app').firstChild) {
              document.querySelector('#app').firstChild.replaceWith(wrapper);
            } else {
              document.querySelector('#app').appendChild(wrapper);
            }
            ++i;
          },
        })
        .add('JavaScript Fair', {
          setup() {
            document.querySelector('#app').outerHTML = '<div id="app"></div>';
            i = 0;
          },
          fn() {
            document.querySelector('#app').innerHTML = `<div>${`<div>${String(Date.now())}</div>`.repeat(++i)}</div>`;
          },
        })
        .on('cycle', ({ target }) => {
          console.log(String(target));
        })
        .on('complete', function () {
          console.log(`Fastest is ${this.filter('fastest').map('name')}`);
        })
        .run({ async: true });
    </script>
  </body>
</html>
